<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Battleship Shape Helper</title>
<style>
  body { font-family: sans-serif; text-align: center; }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 40px);
    gap: 4px;
    justify-content: center;
  }
  .cell {
    width: 40px; height: 40px;
    border: 1px solid #333;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 18px;
  }
  .hit { background: #4caf50; }
  .miss { background: #f44336; }
  .suggest { background: #ffeb3b; }
</style>
</head>
<body>

<h3>Battleship Guess Helper</h3>
<p>Click: Unknown → Hit → Miss → Reset</p>

<div class="grid" id="grid"></div>
<p><b>Yellow = best next guesses</b></p>

<script>
const SIZE = 8;
let board = Array.from({length: SIZE}, () => Array(SIZE).fill(0));

const shapes = [
  [[0,0],[0,1]], [[0,0],[1,0]],                     // 2 straight
  [[0,0],[0,1],[0,2]], [[0,0],[1,0],[2,0]],         // 3 straight
  [[0,0],[1,0],[1,1]], [[0,0],[0,1],[1,0]],         // L
  [[0,0],[0,1],[1,1]], [[0,0],[1,0],[1,-1]],
  [[0,0],[0,1],[1,0],[1,1]]                         // 2x2 square
];

const grid = document.getElementById("grid");

function isShapeComplete(shape, r, c) {
  return shape.every(([dr,dc]) => {
    let x=r+dr, y=c+dc;
    return x>=0 && y>=0 && x<SIZE && y<SIZE && board[x][y]===1;
  });
}

function probabilityMap() {
  let prob = Array.from({length: SIZE}, () => Array(SIZE).fill(0));
  let activeHits = new Set();

  for (let r=0;r<SIZE;r++)
    for (let c=0;c<SIZE;c++)
      if (board[r][c]===1) activeHits.add(`${r},${c}`);

  for (let r=0;r<SIZE;r++)
    for (let c=0;c<SIZE;c++)
      for (let s of shapes)
        if (isShapeComplete(s,r,c))
          s.forEach(([dr,dc])=>activeHits.delete(`${r+dr},${c+dc}`));

  // SEARCH MODE
  if (activeHits.size===0) {
    for (let r=0;r<SIZE;r++)
      for (let c=0;c<SIZE;c++)
        if (board[r][c]===0 && (r+c)%2===0) prob[r][c]=1;
    return prob;
  }

  // TARGET MODE
  for (let r=0;r<SIZE;r++) for (let c=0;c<SIZE;c++) {
    for (let shape of shapes) {
      let cells = shape.map(([dr,dc])=>[r+dr,c+dc]);
      if (cells.some(([x,y])=>x<0||y<0||x>=SIZE||y>=SIZE)) continue;

      let vals = cells.map(([x,y])=>board[x][y]);
      if (vals.includes(-1)) continue;
      if (!cells.some(([x,y])=>activeHits.has(`${x},${y}`))) continue;

      cells.forEach(([x,y])=>{
        if (board[x][y]===0) prob[x][y]++;
      });
    }
  }
  return prob;
}

function render() {
  grid.innerHTML="";
  let prob = probabilityMap();
  let max = Math.max(...prob.flat());

  for (let r=0;r<SIZE;r++) for (let c=0;c<SIZE;c++) {
    let d=document.createElement("div");
    d.className="cell";

    if (board[r][c]===1) d.classList.add("hit"), d.textContent="✓";
    if (board[r][c]===-1) d.classList.add("miss"), d.textContent="×";
    if (board[r][c]===0 && prob[r][c]===max && max>0)
      d.classList.add("suggest");

    d.onclick=()=>{
      board[r][c]=board[r][c]===0?1:board[r][c]===1?-1:0;
      render();
    };
    grid.appendChild(d);
  }
}

render();
</script>
</body>
</html>
