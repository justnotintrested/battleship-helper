<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Guess Helper</title>
<style>
  body { font-family: sans-serif; text-align: center; }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 40px);
    gap: 4px;
    justify-content: center;
  }
  .cell {
    width: 40px; height: 40px;
    border: 1px solid #333;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 18px;
  }
  .hit { background:#4caf50; }
  .miss { background:#f44336; }
  .suggest { background:#ffeb3b; }
</style>
</head>
<body>

<h3>Guess Helper</h3>
<p>Click: Unknown → Hit → Miss → Reset</p>

<div class="grid" id="grid"></div>

<script>
const SIZE = 8;
let board = Array.from({length: SIZE}, () => Array(SIZE).fill(0));

const shapes = [
  [[0,0],[0,1]], [[0,0],[1,0]],                 // 2 straight
  [[0,0],[0,1],[0,2]], [[0,0],[1,0],[2,0]],     // 3 straight
  [[0,0],[1,0],[1,1]], [[0,0],[0,1],[1,0]],     // L
  [[0,0],[0,1],[1,1]], [[0,0],[1,0],[1,-1]],
  [[0,0],[0,1],[1,0],[1,1]]                     // square
];

const grid = document.getElementById("grid");

function shapeComplete(shape,r,c){
  return shape.every(([dr,dc])=>{
    let x=r+dr,y=c+dc;
    return x>=0&&y>=0&&x<SIZE&&y<SIZE&&board[x][y]===1;
  });
}

function bestPlacement() {
  let best=null, bestScore=-Infinity;

  // remove sunk shapes
  let activeHits=new Set();
  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)
    if(board[r][c]===1) activeHits.add(`${r},${c}`);

  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)
    for(let s of shapes)
      if(shapeComplete(s,r,c))
        s.forEach(([dr,dc])=>activeHits.delete(`${r+dr},${c+dc}`));

  // SEARCH MODE
  if(activeHits.size===0){
    let cells=[];
    for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)
      if(board[r][c]===0&&(r+c)%2===0) cells.push([r,c]);
    return cells.length?cells:null;
  }

  // TARGET MODE
  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){
    for(let s of shapes){
      let cells=s.map(([dr,dc])=>[r+dr,c+dc]);
      if(cells.some(([x,y])=>x<0||y<0||x>=SIZE||y>=SIZE))continue;

      let hits=0,unknown=0,invalid=false;
      for(let [x,y] of cells){
        if(board[x][y]===-1){invalid=true;break;}
        if(board[x][y]===1)hits++;
        if(board[x][y]===0)unknown++;
      }
      if(invalid||hits===0)continue;

      let score=hits*10-unknown;
      if(score>bestScore){
        bestScore=score;
        best=cells.filter(([x,y])=>board[x][y]===0);
      }
    }
  }
  return best;
}

function render(){
  grid.innerHTML="";
  let suggestion=bestPlacement();

  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){
    let d=document.createElement("div");
    d.className="cell";

    if(board[r][c]===1)d.classList.add("hit"),d.textContent="✓";
    if(board[r][c]===-1)d.classList.add("miss"),d.textContent="×";

    if(board[r][c]===0&&suggestion&&
       suggestion.some(([x,y])=>x===r&&y===c))
      d.classList.add("suggest");

    d.onclick=()=>{
      board[r][c]=board[r][c]===0?1:board[r][c]===1?-1:0;
      render();
    };
    grid.appendChild(d);
  }
}

render();
</script>
</body>
</html>
